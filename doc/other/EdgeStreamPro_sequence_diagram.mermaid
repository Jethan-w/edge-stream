sequenceDiagram
    participant M as Main
    participant SE as StreamEngine
    participant CM as ConfigManager
    participant P as Pipeline
    participant S as Source
    participant PR as Processor
    participant WM as WindowManager
    participant W as Window
    participant SI as Sink
    participant SM as StateManager
    participant MC as MetricCollector

    M->>CM: LoadConfig("config.yaml")
    CM-->>M: Config
    M->>SE: NewStreamEngine(config)
    SE->>SM: Initialize(stateConfig)
    SE->>MC: Initialize(metricConfig)
    SE->>P: NewPipeline(pipelineConfig)
    
    M->>SE: Start()
    SE->>P: Initialize()
    P->>S: Connect()
    S-->>P: Connection established
    P->>SI: Connect()
    SI-->>P: Connection established
    P->>WM: Initialize(windowConfigs)
    
    SE->>P: Process(ctx)
    
    loop Main Processing Loop
        P->>S: Read(ctx)
        S-->>P: Record
        P->>PR: Process(record)
        PR-->>P: ProcessedRecords
        
        P->>WM: ProcessRecord(record)
        WM->>W: Add(record)
        W-->>WM: WindowResult (if triggered)
        
        alt Window Triggered
            WM->>SM: Put(windowState)
            WM->>SI: Write(windowResult)
        end
        
        P->>SI: Write(processedRecord)
        SI-->>P: WriteAck
        
        P->>MC: RecordLatency(duration)
        P->>MC: RecordThroughput(1)
    end
    
    alt Error Handling
        PR-->>P: ProcessingError
        P->>MC: RecordError("processing")
        P->>SI: Write(errorRecord)
    end
    
    alt Hot Reload
        CM->>SE: ConfigChanged(newConfig)
        SE->>P: UpdateConfig(newConfig)
        P->>PR: Reconfigure(processorConfig)
        P->>WM: UpdateWindows(windowConfig)
    end
    
    alt Shutdown
        M->>SE: Stop()
        SE->>P: Stop()
        P->>S: Close()
        P->>SI: Close()
        SE->>SM: CreateCheckpoint()
        SE->>MC: Flush()
    end